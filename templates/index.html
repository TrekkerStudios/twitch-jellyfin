{% extends "base.html" %}
{% block content %}
<div class="grid grid-2-1">
  <!-- Left Column -->
  <div class="grid" style="gap:1.5rem">
    <!-- Stream Access -->
    <div class="card">
      <h2>Stream Access</h2>
      <div class="grid" style="grid-auto-flow: column; gap:0.5rem; flex-wrap:wrap">
        <a href="{{ request.host_url }}stream.m3u8" class="btn btn-primary">Stream.m3u8</a>
        <a href="{{ request.host_url }}playlist.m3u" class="btn btn-secondary">M3U Playlist</a>
        <a href="{{ request.host_url }}guide.xml" class="btn btn-secondary">XMLTV Guide</a>
        <a href="{{ request.host_url }}status" target="_blank" class="btn btn-secondary">Status JSON</a>
      </div>
    </div>

    <!-- Configuration -->
    <div class="card">
      <h3>Configuration</h3>
      <form method="POST">
        <label for="twitch_channel">Twitch Channel</label>
        <div class="form-row">
          <input type="text" name="twitch_channel" id="twitch_channel" value="{{ cfg.twitch_channel }}">
          <button type="submit" class="btn btn-secondary">Save</button>
        </div>
      </form>
    </div>

    <!-- Branding -->
    <div class="card">
      <h3>Channel Branding</h3>
      <form method="POST" enctype="multipart/form-data">
        <div class="form-row" style="align-items:center; gap:1rem; margin-bottom:1rem">
          <img src="{{ logo_url }}" class="logo-preview">
          <div style="flex:1">
            <label for="channel_name">Channel Name</label>
            <input type="text" name="channel_name" id="channel_name" value="{{ cfg.channel_name }}">
          </div>
        </div>
        <label for="channel_logo">Upload New Logo</label>
        <input type="file" name="channel_logo" id="channel_logo">
        <div class="grid" style="grid-auto-flow: column; gap:0.5rem; margin-top:1rem">
          <button type="submit" class="btn btn-primary">Save Branding</button>
          <a href="/revert_branding" class="btn btn-warning">Revert to Default</a>
        </div>
      </form>
    </div>
  </div>

  <!-- Right Column -->
  <div class="grid" style="gap:1.5rem">
    <!-- YouTube Channels -->
    <div class="card">
      <h3>YouTube Channels</h3>
      <div>{{ yt_list|safe }}</div>
      <form method="POST" style="margin-top:1rem">
        <label for="yt_channel">Add Channel</label>
        <div class="form-row">
          <input type="text" name="yt_channel" id="yt_channel" placeholder="@handle or channel/ID">
          <button type="submit" class="btn btn-secondary">Add</button>
        </div>
      </form>
      <div class="grid" style="grid-auto-flow: column; gap:0.5rem; margin-top:1rem">
        <form method="POST" action="/refresh_youtube">
          <button type="submit" class="btn btn-warning">Force Refresh</button>
        </form>
        <form method="POST" action="/clear_cache">
          <button type="submit" class="btn btn-danger">Clear Cache</button>
        </form>
      </div>
      <form method="POST" enctype="multipart/form-data" style="margin-top:1rem">
        <label for="cookies">Upload Cookies.txt</label>
        <input type="file" name="cookies" id="cookies">
        <button type="submit" class="btn btn-primary btn-block">Upload Cookies</button>
      </form>
    </div>

    <!-- Playlist Preview -->
    <div class="card">
      <h3>Current YouTube Playlist</h3>
      <div>{{ playlist_preview|safe }}</div>
    </div>
  </div>
</div>

<!-- Transcoding -->
<div class="card" style="margin-top:1.5rem">
  <h3>YouTube Transcoding</h3>
  <form method="POST" action="/update_transcode">
    <label>Enable Transcoding</label>
    <select name="youtube_transcode">
      <option value="true" {% if cfg.youtube_transcode %}selected{% endif %}>Yes</option>
      <option value="false" {% if not cfg.youtube_transcode %}selected{% endif %}>No (remux only)</option>
    </select>

    <label>CRF (Video Quality)</label>
    <input type="number" name="youtube_crf" min="15" max="30" value="{{ cfg.youtube_crf or 20 }}">
    <p style="font-size:0.8rem; color:#aaa">Lower = higher quality (default 20)</p>

    <label>Audio Bitrate</label>
    <input type="text" name="youtube_audio_bitrate" value="{{ cfg.youtube_audio_bitrate or '192k' }}">

    <button type="submit" class="btn btn-primary btn-block" style="margin-top:1rem">
      Save Transcoding Settings
    </button>
  </form>
</div>
{% endblock %}